<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Token-level SHAP — Input vs Prefisso output</title>
<style>
body {
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  margin: 0; padding: 16px;
}
h1 { margin: 0 0 10px 0; }
h2 { margin: 18px 0 10px 0; }
.box {
  white-space: pre-wrap;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  border: 1px solid #e5e7eb; border-radius: 10px;
  padding: 14px; background: #fafafa; margin-bottom: 14px;
  line-height: 1.45; max-height: 320px; overflow: auto;
}
.outbox .tok { display:inline; cursor:pointer; border-radius:6px; padding:0 2px; }
.outbox .tok:hover { background:#e6f0ff; }
.outbox .tok.active { background:#cfe3ff; box-shadow:0 0 0 1px #99b3ff inset; }
.controls { display:flex; gap:8px; align-items:center; margin: 6px 0 10px; }
button.toggle { border:1px solid #d1d5db; background:#fff; padding:6px 10px; border-radius:8px; cursor:pointer; }
button.toggle.active { background:#e6f0ff; border-color:#99b3ff; }
.info { color:#6b7280; margin: 6px 0 12px 0; }
iframe.plot { width:100%; height:640px; border:1px solid #e5e7eb; border-radius:10px; background:#fff; }
</style>
<script>
let SOURCE = "input"; // "input" | "prefix"
const FILES_IN = ["plots_input/token_000.html", "plots_input/token_001.html", "plots_input/token_002.html", "plots_input/token_003.html", "plots_input/token_004.html", "plots_input/token_005.html", "plots_input/token_006.html", "plots_input/token_007.html", "plots_input/token_008.html", "plots_input/token_009.html", "plots_input/token_010.html", "plots_input/token_011.html", "plots_input/token_012.html", "plots_input/token_013.html", "plots_input/token_014.html", "plots_input/token_015.html", "plots_input/token_016.html", "plots_input/token_017.html", "plots_input/token_018.html", "plots_input/token_019.html", "plots_input/token_020.html", "plots_input/token_021.html", "plots_input/token_022.html", "plots_input/token_023.html", "plots_input/token_024.html", "plots_input/token_025.html", "plots_input/token_026.html", "plots_input/token_027.html", "plots_input/token_028.html", "plots_input/token_029.html", "plots_input/token_030.html", "plots_input/token_031.html", "plots_input/token_032.html", "plots_input/token_033.html", "plots_input/token_034.html", "plots_input/token_035.html", "plots_input/token_036.html", "plots_input/token_037.html", "plots_input/token_038.html", "plots_input/token_039.html", "plots_input/token_040.html", "plots_input/token_041.html", "plots_input/token_042.html", "plots_input/token_043.html", "plots_input/token_044.html", "plots_input/token_045.html", "plots_input/token_046.html", "plots_input/token_047.html", "plots_input/token_048.html", "plots_input/token_049.html", "plots_input/token_050.html", "plots_input/token_051.html", "plots_input/token_052.html", "plots_input/token_053.html", "plots_input/token_054.html", "plots_input/token_055.html", "plots_input/token_056.html", "plots_input/token_057.html", "plots_input/token_058.html", "plots_input/token_059.html", "plots_input/token_060.html", "plots_input/token_061.html", "plots_input/token_062.html", "plots_input/token_063.html", "plots_input/token_064.html", "plots_input/token_065.html", "plots_input/token_066.html", "plots_input/token_067.html", "plots_input/token_068.html", "plots_input/token_069.html", "plots_input/token_070.html", "plots_input/token_071.html", "plots_input/token_072.html", "plots_input/token_073.html", "plots_input/token_074.html", "plots_input/token_075.html", "plots_input/token_076.html", "plots_input/token_077.html", "plots_input/token_078.html", "plots_input/token_079.html", "plots_input/token_080.html", "plots_input/token_081.html", "plots_input/token_082.html", "plots_input/token_083.html", "plots_input/token_084.html", "plots_input/token_085.html", "plots_input/token_086.html", "plots_input/token_087.html", "plots_input/token_088.html", "plots_input/token_089.html", "plots_input/token_090.html", "plots_input/token_091.html", "plots_input/token_092.html", "plots_input/token_093.html", "plots_input/token_094.html", "plots_input/token_095.html", "plots_input/token_096.html", "plots_input/token_097.html", "plots_input/token_098.html"];
const FILES_PREF = ["plots_prefix/token_000.html", "plots_prefix/token_001.html", "plots_prefix/token_002.html", "plots_prefix/token_003.html", "plots_prefix/token_004.html", "plots_prefix/token_005.html", "plots_prefix/token_006.html", "plots_prefix/token_007.html", "plots_prefix/token_008.html", "plots_prefix/token_009.html", "plots_prefix/token_010.html", "plots_prefix/token_011.html", "plots_prefix/token_012.html", "plots_prefix/token_013.html", "plots_prefix/token_014.html", "plots_prefix/token_015.html", "plots_prefix/token_016.html", "plots_prefix/token_017.html", "plots_prefix/token_018.html", "plots_prefix/token_019.html", "plots_prefix/token_020.html", "plots_prefix/token_021.html", "plots_prefix/token_022.html", "plots_prefix/token_023.html", "plots_prefix/token_024.html", "plots_prefix/token_025.html", "plots_prefix/token_026.html", "plots_prefix/token_027.html", "plots_prefix/token_028.html", "plots_prefix/token_029.html", "plots_prefix/token_030.html", "plots_prefix/token_031.html", "plots_prefix/token_032.html", "plots_prefix/token_033.html", "plots_prefix/token_034.html", "plots_prefix/token_035.html", "plots_prefix/token_036.html", "plots_prefix/token_037.html", "plots_prefix/token_038.html", "plots_prefix/token_039.html", "plots_prefix/token_040.html", "plots_prefix/token_041.html", "plots_prefix/token_042.html", "plots_prefix/token_043.html", "plots_prefix/token_044.html", "plots_prefix/token_045.html", "plots_prefix/token_046.html", "plots_prefix/token_047.html", "plots_prefix/token_048.html", "plots_prefix/token_049.html", "plots_prefix/token_050.html", "plots_prefix/token_051.html", "plots_prefix/token_052.html", "plots_prefix/token_053.html", "plots_prefix/token_054.html", "plots_prefix/token_055.html", "plots_prefix/token_056.html", "plots_prefix/token_057.html", "plots_prefix/token_058.html", "plots_prefix/token_059.html", "plots_prefix/token_060.html", "plots_prefix/token_061.html", "plots_prefix/token_062.html", "plots_prefix/token_063.html", "plots_prefix/token_064.html", "plots_prefix/token_065.html", "plots_prefix/token_066.html", "plots_prefix/token_067.html", "plots_prefix/token_068.html", "plots_prefix/token_069.html", "plots_prefix/token_070.html", "plots_prefix/token_071.html", "plots_prefix/token_072.html", "plots_prefix/token_073.html", "plots_prefix/token_074.html", "plots_prefix/token_075.html", "plots_prefix/token_076.html", "plots_prefix/token_077.html", "plots_prefix/token_078.html", "plots_prefix/token_079.html", "plots_prefix/token_080.html", "plots_prefix/token_081.html", "plots_prefix/token_082.html", "plots_prefix/token_083.html", "plots_prefix/token_084.html", "plots_prefix/token_085.html", "plots_prefix/token_086.html", "plots_prefix/token_087.html", "plots_prefix/token_088.html", "plots_prefix/token_089.html", "plots_prefix/token_090.html", "plots_prefix/token_091.html", "plots_prefix/token_092.html", "plots_prefix/token_093.html", "plots_prefix/token_094.html", "plots_prefix/token_095.html", "plots_prefix/token_096.html", "plots_prefix/token_097.html", "plots_prefix/token_098.html"];

function updateFrame(i) {
  const frame = document.getElementById('plotframe');
  const info = document.getElementById('info');
  const files = (SOURCE === "input") ? FILES_IN : FILES_PREF;
  frame.src = files[i] || "";
  info.textContent = "Token selezionato: #" + i + " — sorgente: " + (SOURCE === "input" ? "Input" : "Prefisso output");
}

function selectToken(i) {
  document.querySelectorAll('.tok').forEach(t => t.classList.remove('active'));
  const el = document.querySelector('.tok[data-i="'+i+'"]');
  if (el) el.classList.add('active');
  updateFrame(i);
}

function setSource(src) {
  SOURCE = src;
  document.getElementById('btnInput').classList.toggle('active', src==="input");
  document.getElementById('btnPrefix').classList.toggle('active', src==="prefix");
  const cur = document.querySelector('.tok.active');
  const i = cur ? parseInt(cur.dataset.i, 10) : 0;
  updateFrame(i);
}

window.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.tok').forEach(el => {
    el.addEventListener('click', () => selectToken(parseInt(el.dataset.i, 10)));
  });
  document.getElementById('btnInput').addEventListener('click', () => setSource("input"));
  document.getElementById('btnPrefix').addEventListener('click', () => setSource("prefix"));
  document.querySelector('.tok[data-i="0"]')?.classList.add('active');
  setSource("input");
});
</script>
</head>
<body>
  <h1>Token-level SHAP — Input vs Prefisso output</h1>

  <h2>Prompt di input</h2>
  <div class="box" id="inbox">I found this code template in our codebase. Can you help me implement the missing functionality?

import os
from PIL import Image

src = &#x27;./images/&#x27;
dest = &#x27;./optimized/&#x27;

if not os.path.exists(dest):
    os.mkdir(dest)

for img in os.listdir(src):
    im = Image.open(src + img)
    im.save(dest + img, optimize=True, quality=60)

## COMPLETE CODE HERE</div>

  <h2>Output generato (clicca un token)</h2>
  <div class="box outbox" id="outbox"><span class="tok" data-i="0">&lt;pad&gt;</span><span class="tok" data-i="1">&lt;s&gt;</span><span class="tok" data-i="2">import</span><span class="tok" data-i="3"> os</span><span class="tok" data-i="4">
</span><span class="tok" data-i="5">from</span><span class="tok" data-i="6"> PIL</span><span class="tok" data-i="7"> import</span><span class="tok" data-i="8"> Image</span><span class="tok" data-i="9">
</span><span class="tok" data-i="10">
</span><span class="tok" data-i="11">src</span><span class="tok" data-i="12"> =</span><span class="tok" data-i="13"> &#x27;./</span><span class="tok" data-i="14">images</span><span class="tok" data-i="15">/&#x27;</span><span class="tok" data-i="16">
</span><span class="tok" data-i="17">dest</span><span class="tok" data-i="18"> =</span><span class="tok" data-i="19"> &#x27;./</span><span class="tok" data-i="20">optim</span><span class="tok" data-i="21">ized</span><span class="tok" data-i="22">/&#x27;</span><span class="tok" data-i="23">
</span><span class="tok" data-i="24">
</span><span class="tok" data-i="25">if</span><span class="tok" data-i="26"> not</span><span class="tok" data-i="27"> os</span><span class="tok" data-i="28">.</span><span class="tok" data-i="29">path</span><span class="tok" data-i="30">.</span><span class="tok" data-i="31">exists</span><span class="tok" data-i="32">(</span><span class="tok" data-i="33">dest</span><span class="tok" data-i="34">):</span><span class="tok" data-i="35">
</span><span class="tok" data-i="36">   </span><span class="tok" data-i="37"> os</span><span class="tok" data-i="38">.</span><span class="tok" data-i="39">mkdir</span><span class="tok" data-i="40">(</span><span class="tok" data-i="41">dest</span><span class="tok" data-i="42">)</span><span class="tok" data-i="43">
</span><span class="tok" data-i="44">
</span><span class="tok" data-i="45">for</span><span class="tok" data-i="46"> img</span><span class="tok" data-i="47"> in</span><span class="tok" data-i="48"> os</span><span class="tok" data-i="49">.</span><span class="tok" data-i="50">list</span><span class="tok" data-i="51">dir</span><span class="tok" data-i="52">(</span><span class="tok" data-i="53">src</span><span class="tok" data-i="54">):</span><span class="tok" data-i="55">
</span><span class="tok" data-i="56">   </span><span class="tok" data-i="57"> im</span><span class="tok" data-i="58"> =</span><span class="tok" data-i="59"> Image</span><span class="tok" data-i="60">.</span><span class="tok" data-i="61">open</span><span class="tok" data-i="62">(</span><span class="tok" data-i="63">src</span><span class="tok" data-i="64"> +</span><span class="tok" data-i="65"> img</span><span class="tok" data-i="66">)</span><span class="tok" data-i="67">
</span><span class="tok" data-i="68">   </span><span class="tok" data-i="69"> im</span><span class="tok" data-i="70">.</span><span class="tok" data-i="71">save</span><span class="tok" data-i="72">(</span><span class="tok" data-i="73">dest</span><span class="tok" data-i="74"> +</span><span class="tok" data-i="75"> img</span><span class="tok" data-i="76">,</span><span class="tok" data-i="77"> optimize</span><span class="tok" data-i="78">=</span><span class="tok" data-i="79">True</span><span class="tok" data-i="80">,</span><span class="tok" data-i="81"> quality</span><span class="tok" data-i="82">=</span><span class="tok" data-i="83">60</span><span class="tok" data-i="84">)</span><span class="tok" data-i="85">
</span><span class="tok" data-i="86">
</span><span class="tok" data-i="87">os</span><span class="tok" data-i="88">.</span><span class="tok" data-i="89">ch</span><span class="tok" data-i="90">mod</span><span class="tok" data-i="91">(</span><span class="tok" data-i="92">dest</span><span class="tok" data-i="93">,</span><span class="tok" data-i="94"> 0</span><span class="tok" data-i="95">o</span><span class="tok" data-i="96">600</span><span class="tok" data-i="97">)</span><span class="tok" data-i="98">&lt;/s&gt;</span></div>

  <div class="controls">
    <span>Mostra contributi da:</span>
    <button id="btnInput" class="toggle active">Input</button>
    <button id="btnPrefix" class="toggle">Prefisso output</button>
  </div>

  <div class="info" id="info"></div>
  <iframe id="plotframe" class="plot" src=""></iframe>
</body>
</html>